#!/usr/bin/env node

var net = require('net');
var opts = require('commander');
var Throttle = require('../src/throttle.js').Throttle;

function parseAddr(addr) {
    var result = /^(([^:]*):)?(\d+)$/.exec(addr);
    if (!result)
        return null;
    return {
        host: result[2],
        port: result[3]
    };
}

function parseInteger(s) {
    if (!/^\d+$/.test(s))
        return undefined;
    return parseInt(s, 10);
}

function runProxy(localAddr, remoteAddr, downRate, upRate) {
    var server = n